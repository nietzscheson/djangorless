FROM python:3.9

### AWS ###
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_STORAGE_BUCKET_NAME
ARG USE_S3

### Cognito ###
ARG COGNITO_USER_POOL_ID
ARG COGNITO_CLIENT_ID
ARG COGNITO_CLIENT_SECRET

ENV PYTHONUNBUFFERED 1

### AWS ###
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV AWS_STORAGE_BUCKET_NAME=$AWS_STORAGE_BUCKET_NAME
ENV USE_S3=$USE_S3

### Cognito ###
ENV COGNITO_USER_POOL_ID=$COGNITO_USER_POOL_ID
ENV COGNITO_CLIENT_ID=$COGNITO_CLIENT_ID
ENV COGNITO_CLIENT_SECRET=$COGNITO_CLIENT_SECRET

COPY requirements.txt  .
RUN  pip3 install -r requirements.txt

RUN useradd --create-home core
WORKDIR /home/core
USER core

COPY . ./

ENTRYPOINT [ "sh", "./entrypoint.sh" ]

CMD [ "handler.handler" ]
